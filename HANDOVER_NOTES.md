# PC再起動後の作業再開手順 (2025/09/13) - 更新

## 現状サマリー

- **最終目標:** 本番環境(`us-east-1`)の障害を復旧し、よりコスト効率の高い`g6.xlarge`インスタンスでサービスを安定稼働させる。
- **ローカルの変更:**
    1.  インスタンスタイプを `g5.2xlarge` から `g6.xlarge` に変更済み (`asg_construct.py`)。
    2.  Dockerビルドの失敗を修正するため、ビルドコンテキストとDockerfile内のパスを修正済み (`ecs_construct.py`, `Dockerfile`, `scripts/entrypoint.sh`)。
- **本番環境 (`us-east-1`):**
    - 障害が発生したスタックは完全に削除済みで、クリーンな状態です。
    - はかせが手動で復旧作業を行うためのCloudFormationテンプレート (`.gemini/tmp/ComfyUIStack.production.template.json`) を生成済みです。
- **ステージング環境 (`us-east-2`):**
    - 以前の失敗したスタックは完全に削除済みで、クリーンな状態です。
    - 最新の修正を適用したデプロイを実行する直前の状態です。

---

## 次の作業ステップ

### ステップ1: ステージング環境 (`us-east-2`) へのデプロイ

これから、全ての修正を適用した最新のコードで、ステージング環境へのデプロイを開始します。

- **目的:** `g6.xlarge` インスタンスと、修正されたDockerビルドプロセスが正常に動作するかを最終検証する。
- **実行コマンド (Geminiが実行):** `cdk deploy` (ステージング向け)
- **監視:** デプロイの進捗はSlackに通知されます。

### ステップ2: ステージング環境の動作確認

デプロイ完了後、`https://stg-comfyui.aicu.jp` にアクセスし、サービスが正常に起動・動作するかを確認します。

### ステップ3: 本番環境 (`us-east-1`) へのデプロイ

ステージングでの検証が成功した場合、**全く同じ検証済みのコード**を使用して本番環境のデプロイを開始します。これにより、安全かつ確実にサービスを復旧させます。

### ステップ4: 不要リソースのクリーンアップ

全ての作業が完了したら、不要なコストを避けるため、`cdk destroy` でステージング環境を削除します。